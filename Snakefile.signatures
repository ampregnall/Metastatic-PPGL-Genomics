configfile: "config.yaml"

rule all:    
    input:
        FFPE = expand("data/processed/snvs/mutational_signatures/FFPESig/{sample}_corrected_profile.csv", sample=config["samples"])

rule run_FFPESig:
    input: "data/processed/snvs/mutational_signatures/MetastaticPPGL.SBS96.csv"
    params:
        folder = "data/processed/snvs/mutational_signatures/FFPESig"
    output: "data/processed/snvs/mutational_signatures/FFPESig/{sample}_corrected_profile.csv"
    run:
        if wildcards.sample == "PP245-DZ2A": # Mutational burden is too low for FFPESig
            shell("python src/somatic_variant_analysis/handle_FFPESig_exceptions.py {input} {output} {wildcards.sample}")
        else:
            shell("python src/somatic_variant_analysis/FFPESig.py --input={input} --sample={wildcards.sample} --label=Unrepaired --output={params.folder}")

rule generate_SNV_catalog:
    input: "data/processed/snvs/drivers/PPGL.somatic.data.combined.filtered.txt"
    output: "data/processed/snvs/mutational_signatures/MetastaticPPGL.SBS96.csv"
    shell: "Rscript src/somatic_variant_analysis/generate_SBS96_catalog.R --input={input} --output={output}"
